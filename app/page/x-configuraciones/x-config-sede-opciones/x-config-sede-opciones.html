<!-- FILEPATH: /system$/restobar/app/page/x-configuraciones/x-config-sede-opciones/x-config-sede-opciones.html -->

<dom-module id="x-config-sede-opciones">
    <template>
        <style>
            /* Add your custom styles here */
        </style>
        
        <div class="config-options">
            <!-- <h3>Opciones de Configuración de Sede</h3> -->
            <table>
                <tr>
                    <td><p class="fs-15 fw-600">Número de Intentos de Cierre:</p>
                        <span class="text-secondary">Indique el numero de intentos permitidos para cerrar caja.</span>
                    </td>
                    <td>
                        <input class="selected-template-1" type="number" id="numIntentos" name="num-intentos" min="0" max="10" value="3">
                    </td>
                </tr>
                <tr>
                    <td><p class="fs-15 fw-600">No permitir cerra caja con cuentas pedientes de que cobrar:</p>
                        <span class="text-secondary">Indique si <strong>NO</strong> desea que cierre caja si hay cuentas pendientes de cobrar.</span>
                    </td>
                    <td>
                        <input type="checkbox" id="allowCierre" name="allow-cierre">
                    </td>
                </tr>
                <tr>
                    <td><p class="fs-15 fw-600">Descontar stock al finalizar el pedido:</p>
                        <span class="text-secondary">El stock se descuenta inmediatamente al seleccionar el producto, marque esta opción si desea que se descuente al finalizar o enviar el pedido</span>
                    </td>
                    <td>
                        <input type="checkbox" id="descuentoStock" name="descuento-stock">
                    </td>
                </tr>
                <tr>
                    <td>
                        <p class="fs-15 fw-600">Hora de cierre del dia.</p>
                        <span class="text-secondary">Indique la hora en formato 24hrs cuando cerrar dia. Esto es importante para los reportes, Ejemplo: si su horario de atención es hasta las 3am entonces el dia se calculara hasta esa hora, de lo contrario hasta las 0:00</span>
                    </td>
                    <td>
                        <input class="selected-template-1" type="time" id="horaCierre" name="hora-cierre">
                    </td>
                </tr>
            </table>
                  
            <br>
            
            <button class="btn btn-primary" dialog-dismiss on-click="saveInputs" >Guardar</button>
        </div>
    </template>
    
    <script>
        Polymer({
            is: 'x-config-sede-opciones',
            /* Add your component logic here */
            properties: {  
                data: {
                    type: Object,
                    notify: true
                }                         
            },            
            saveInputs: function() {
                let inputs = {};
                const numIntentos = this.$.numIntentos.value;
                const allowCierre = this.$.allowCierre.checked ? 1 : 0;
                const descuentoStock = this.$.descuentoStock.checked ? 1 : 0;
                const hora_cierre_dia = this.$.horaCierre.value;

                inputs.switch2 = allowCierre;
                inputs.num_intentos_cierre = numIntentos;
                inputs.update_stock_after = descuentoStock;
                inputs.hora_cierre = hora_cierre_dia;


                console.log('inputs', inputs);
                const _httpFech = new httpFecht();
                const _url = '../../bdphp/log_componentes.php?op=2205';
                _httpFech.axiosExecute({ type: 'POST', url: _url, data: { items: inputs } }).then((data) => {                    
                    if (data.success) {
                        showToastSwal('success', 'Listo se guardo los datos.');
                    }
                }).catch((err) => {
                    console.log('err', err);
                });
                
                // Send the inputs array to the backend
                // ...
            },
            loadData: function() {
                // Retrieve data for the given idsede from the backend
                // ...
                const _httpFech = new httpFecht();
                const _url = '../../bdphp/log_componentes.php?op=2204';
                
                _httpFech.axiosExecute({
                    url: _url                    
                }, false, false).then((data) => {
                    console.log('data', data);
                    if (data.success) {
                        const _data = data.datos[0];
                        if ( _data ) {
                            this.data = _data;
                            this.$.numIntentos.value = _data.num_intentos_cierre;
                            this.$.allowCierre.checked = _data.switch2 === '1';
                            this.$.descuentoStock.checked = _data.update_stock_after === '1';
                            // convertir a formato hora para mostrar en el input time
                            _data.hora_cierre = !_data.hora_cierre || _data.hora_cierre == '0' ? '00:00' : _data.hora_cierre;
                            const _horaCierre = _data.hora_cierre.split(':');
                            this.$.horaCierre.value = `${_horaCierre[0]}:${_horaCierre[1]}`;                            

                        }
                    }
                }).catch((err) => {
                    console.log('err', err);
                });                                            
            },
            ready: function() {
                this.loadData();
            }
        });          
    </script>    
</dom-module>
<!-- FILEPATH: /system$/restobar/app/page/x-configuraciones/x-config-sede-opciones/x-config-sede-opciones.html -->
